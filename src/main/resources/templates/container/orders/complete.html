<!DOCTYPE html>
<html th:replace="~{container/orders/order::view(~{::title}, ~{::article})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ƒê·∫∑t h√†ng th√†nh c√¥ng</title>
    <link href="/css/general.css" rel="stylesheet">
</head>
<body>
<div th:replace="container/orders/order-process :: *"></div>
<article>
    <div class="complete-wrapper">
        <h1>üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng!</h1>
        <h3>C·∫£m ∆°n b·∫°n ƒë√£ tin t∆∞·ªüng v√† ƒë·∫∑t h√†ng t·∫°i c·ª≠a h√†ng ch√∫ng t√¥i.</h3>

        <div class="order-info mt-4" style="max-width: 600px; margin: 0 auto; text-align: left;"
             th:if="${bill != null}">
            
            <div th:if="${qrUrl != null}" class="card p-4 mb-3 text-center">
                <h4>Qu√©t m√£ ƒë·ªÉ thanh to√°n</h4>
                <p>N·ªôi dung chuy·ªÉn kho·∫£n: <strong class="text-danger" th:text="${bill.id}"></strong></p>
                <div class="d-flex justify-content-center">
                    <img th:src="${qrUrl}" alt="M√£ QR Thanh To√°n" class="img-fluid" style="max-width: 300px;">
                </div>
                <p class="text-muted mt-2">Vui l√≤ng gi·ªØ nguy√™n n·ªôi dung chuy·ªÉn kho·∫£n khi qu√©t m√£.</p>
                <p class="text-muted small">H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t tr·∫°ng th√°i sau v√†i ph√∫t.</p>
                
                <script th:inline="javascript">
                    /*<![CDATA[*/
                    const billId = /*[[${bill.id}]]*/ 'HD000000';
                    
                    setInterval(() => {
                        fetch(`/api/payment/check-status/${billId}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.status === 'ƒê√£ thanh to√°n') {
                                    // Reload page to show success status
                                    window.location.reload();
                                }
                            })
                            .catch(err => console.error('Error checking status:', err));
                    }, 3000); // Check every 3 seconds
                    /*]]>*/
                </script>
            </div>

            <div class="card p-4">
                <h5 class="mb-3">Th√¥ng tin ƒë∆°n h√†ng</h5>
                <p><strong>M√£ ƒë∆°n h√†ng:</strong> <span th:text="${bill.id}">HD123456</span></p>
                <p><strong>Ng√†y ƒë·∫∑t:</strong> <span
                        th:text="${#dates.format(bill.date, 'dd/MM/yyyy')}">01/01/2025</span></p>
                <p><strong>Tr·∫°ng th√°i:</strong> 
                    <span class="badge" 
                          th:classappend="${bill.status == 'Ch∆∞a thanh to√°n'} ? 'bg-danger' : (${bill.status == 'ƒê√£ thanh to√°n'} ? 'bg-success' : 'bg-warning')"
                          th:text="${bill.status}">Ch·ªù x√°c nh·∫≠n</span>
                </p>
                <p><strong>Kh√°ch h√†ng:</strong> <span th:text="${bill.customer.name}">T√™n kh√°ch h√†ng</span></p>
                <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span th:text="${bill.customer.phone}">0123456789</span></p>
                <p><strong>ƒê·ªãa ch·ªâ giao h√†ng:</strong>
                    <span th:text="${bill.address.detailAddress} + ', ' + ${bill.address.ward} + ', ' + ${bill.address.city}">
                        ƒê·ªãa ch·ªâ chi ti·∫øt
                    </span>
                </p>
            </div>
        </div>

        <button class="mt-4" style="width:400px">
            <a href="/home" style="text-decoration: none; color: #fff;">Quay v·ªÅ trang ch·ªß</a>
        </button>
    </div>
</article>
</body>
</html>
